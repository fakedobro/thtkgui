<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="LibreOffice 4.0.4.2 (Windows)">
	<META NAME="CREATED" CONTENT="20130710;3303876">
	<META NAME="CHANGED" CONTENT="20130724;22173869">
</HEAD>
<BODY LANG="ru-RU" DIR="LTR">
<P><FONT FACE="Mangal"><SPAN LANG="hi-IN">﻿ </SPAN></FONT>
</P>
<P ALIGN=CENTER><FONT SIZE=4>Общие сведения</FONT></P>
<P ALIGN=LEFT><FONT SIZE=3>Touhou Toolkit (коротко — thtk) —
это инструмент для распаковки и
модификации файлов ресурсов игр серии
Touhou. Он позволяет извлекать и изменять
игровые спрайты, текстуры, графические
элементы интерфейса; внутриигровые
тексты; скрипты уровней, задающие
движения противников и формулы атак;
демо-реплеи и игровые звуки. Он не
позволяет работать с музыкой (кроме
midi-музыки в 6-8 частях) и файлами сохранений.</FONT></P>
<P ALIGN=LEFT><FONT SIZE=3>Touhou Toolkit включает четыре
консольных приложения: thdat обрабатывает
базовые dat-файлы игры, остальные три —
внутренние файлы, получаемые после их
распаковки: thanm — графику, thmsg — диалоги,
thecl — скрипты. Он полноценно работает
с играми, начиная с шестой части. thdat
также может работать с dat-файлами игр
для PC-98 (как правило, эти игры хранятся
в образах дисков с расширением hdi, но их
можно распаковать), но получаемые при
распаковке файлы, за исключением
текстовых, не обрабатываются thtk. Кроме
того, программа может работать и с
файлами сторонних игр, имеющих формат,
совместимый с форматом какой-либо части
Touhou (однако может выдавать необоснованные
предупреждения, если формат названий
файлов модификации отличается от формата
названий файлов соответствующей части
Touhou).</FONT></P>
<P ALIGN=LEFT><FONT SIZE=3>Touhou Toolkit является консольным
приложением, а данная программа —
графическим интерфейсом для него. В первую очередь необходимо 
указать путь к папке с распакованным thtk. Также можно указать путь,
по которому находятся игры. </FONT><FONT SIZE=3>Сам
</FONT><FONT SIZE=3>thtk </FONT><FONT SIZE=3>можно скачать
с <A HREF="https://code.google.com/p/thtk/downloads/list" TARGET="_blank">репозитория
на Google Code</A>, </FONT><FONT SIZE=3>в</FONT><FONT SIZE=3> </FONT><FONT SIZE=3>его
</FONT><FONT SIZE=3>состав </FONT><FONT SIZE=3>также
</FONT><FONT SIZE=3>входит </FONT><FONT SIZE=3>с</FONT><FONT SIZE=3>правка.</FONT></P>
<P ALIGN=CENTER STYLE="page-break-before: always"><FONT SIZE=4>THDAT</FONT></P>
<P ALIGN=LEFT><FONT SIZE=3>Первым этапом работы с
thtk является распаковка основного
dat-файлы игры. Выберите нужную игру в
главном меню (формат dat-файлов менялся
от игры к игре), в поле «Папка» укажите
папку, в которую его нужно распаковать,
в поле «Файл» — адрес нужного dat-файла.
Указывайте основной dat-файл, имеющий
название формата <B>th№(e|r).dat </B><SPAN STYLE="font-weight: normal">(кроме
шестой части, см. далее)</SPAN><B>,</B> файлы
thbgm.dat и score.dat посредством thtk распаковать
нельзя. В шестой части игровой контент
разделён на шесть дат-файлов, содержащих:</FONT></P>
<UL>
	<LI><P ALIGN=LEFT><FONT SIZE=3>CM — спрайты пуль,
	диалоговые изображения и мини-спрайты
	главных героев</FONT></P>
	<LI><P ALIGN=LEFT><FONT SIZE=3>ED — тексты и изображения
	из эндингов и титров</FONT></P>
	<LI><P ALIGN=LEFT><FONT SIZE=3>IN — звуки событий,
	тексты интерфейса</FONT></P>
	<LI><P ALIGN=LEFT><FONT SIZE=3>MD — midi-музыку</FONT></P>
	<LI><P ALIGN=LEFT><FONT SIZE=3>ST — скрипты атак, фоны
	уровней и спеллкарт, мини-спрайты врагов
	и боссов и диалоговые изображения
	последних, тексты диалогов</FONT></P>
	<LI><P ALIGN=LEFT><FONT SIZE=3>TL — изображения  и
	тексты меню.</FONT></P>
</UL>
<P ALIGN=LEFT> <FONT SIZE=3>Назначение кнопок:</FONT></P>
<UL>
	<LI><P ALIGN=LEFT><FONT SIZE=3>«Распаковать архив»
	распаковывает dat-файл в указанную папку.</FONT></P>
	<LI><P ALIGN=LEFT><FONT SIZE=3>«Получить список
	файлов» создаёт в подпапке \lists основной
	папки программы список файлов архива
	в формате txt. Этот список необходим для
	сборки dat-файла, поэтому изменять его
	не рекомендуется — это может повлиять
	на работоспособность игры. Файл списка
	также создаётся автоматически при
	распаковке архива.</FONT></P>
	<LI><P ALIGN=LEFT><FONT SIZE=3>«Создать архив» создаёт
	из файлов в указанной папке новый
	dat-файл. Если целевой dat-файл уже
	существует, он будет переименован перед
	выполнением действия (получит
	дополнительное расширение .bkp№), если
	в настройках включена опция «Создавать
	резервную копию». Иначе он будет заменён.</FONT></P>
</UL>
<P ALIGN=LEFT><FONT SIZE=3>После распаковки в целевой
папке появятся файлы игрового контента.
Некоторые из них (например, демо-реплеи,
изображения и звуки) можно заменять
непосредственно. anm-, ecl- и msg-файлы подлежат
дальнейшей распаковке другими программами
из состава thtk. Остальные, например, .sht
и .std, thtk не обрабатывает.</FONT></P>
<P ALIGN=CENTER STYLE="page-break-before: always"><FONT SIZE=4>THANM</FONT></P>
<P ALIGN=LEFT><FONT SIZE=3>Файлы с расширением .anm
содержат игровую графику в виде файлов
в формате PNG, а также скрипты, описывающие
поведение графических элементов. Они
распаковываются и собираются аналогично
dat-файлам с двумя отличиями:</FONT></P>
<UL>
	<LI><P ALIGN=LEFT><FONT SIZE=3>Программа автоматически
	генерирует предлагаемое имя целевой
	папки для распаковки, совпадающее с
	именем anm-файла. Кроме того, файлы внутри
	anm-архива организованы в каталожную
	структуру, которая воссоздаётся внутри
	целевой папки при распковке. Изменение
	структуры или имён каталогов приведёт
	к неработоспособности игры.</FONT></P>
	<LI><P ALIGN=LEFT><FONT SIZE=3>Информацией для
	создания архива служит не простой
	список файлов, а особый текстовый файл
	— спецификация. Он создаётся при распаковке архива, 
	либо может быть создан нажатием кнопки "Получить спецификацию". 
	Предлагаемое имя спецификации также генерируется
	программой автоматически.</FONT></P>
</UL>
<P ALIGN=LEFT><FONT SIZE=3>Утилита также предоставляет
возможность заменить одно из изображений
в anm-файле, не производя полной пересборки
архива. Для этого в строке «Имя» укажите
заменяемую позицию (для её выбора
воспользуйтесь кнопкой «...» справа от
поля ввода), а в строке «Файл» - новую
версию изображения, после чего нажмите
«Заменить файл в архиве».</FONT></P>
<P ALIGN=CENTER STYLE="page-break-before: always"><FONT SIZE=4>THMSG</FONT></P>
<P ALIGN=LEFT><FONT SIZE=3>В msg-файлах хранятся
игровые диалоги. Такие файлы могут иметь
название формата *.msg (в играх начиная с
девятой) или msg*.dat (в 6-8), каждый из них
содержит один txt-файл (в кодировке Shift
JIS в оригинальных файлах, ASCII в
англофицированных). После выбора файла
для распаковки программа автоматически
сгенерирует имя целевого файла в подпапке
/MSG. Кнопка «Выгрузить архив» распаковывает
msg-файл в текстовый файл, кнопка «Создать
архив» проводит обратную процедуру.
Начиная с десятой части, тексты концовок
и титров нужно распаковывать со флагом
Ending dialogue, этот флаг автоматически
проставляется при выборе msg-файлов с
соответствующим названием.</FONT></P>
<P ALIGN=CENTER STYLE="font-weight: normal; page-break-before: always">
<FONT SIZE=4>THECL</FONT></P>
<P ALIGN=LEFT><FONT SIZE=3><SPAN STYLE="font-weight: normal">В
ecl-файлах хранятся скрипты, задающие
движения противников, формулы атак и
пр. Их внутреннее устройство и обращение
с ними в программе аналогичны описаным
выше для msg-файлов. На странице thtk на
GoogleCode имеется <A HREF="https://code.google.com/p/thtk/w/list" TARGET="_blank">неполное
описание</A> скриптового языка, используемого
в этих файлах.</SPAN></FONT></P>
<P ALIGN=CENTER><FONT SIZE=4><SPAN STYLE="font-weight: normal">Известные
проблемы</SPAN></FONT></P>
<P ALIGN=LEFT><FONT SIZE=3><SPAN STYLE="font-weight: normal">Все
перечисленные здесь проблемы вызваны
самим </SPAN><SPAN STYLE="font-weight: normal">thtk, а не
данным GUI, т.к. воспроизводятся и при
прямом использовании консольного thtk.</SPAN></FONT></P>
<UL>
	<LI><P ALIGN=LEFT><FONT SIZE=3><SPAN STYLE="font-weight: normal">Существует
	проблема с англофицированными дат-файлами
	девятой части. При их распаковке консоль
	сообщает об ошибках, но содержимое
	дат-файла распаковывается полностью
	или почти полностью. Однако дат-файл,
	полученный сборкой такой папки, повреждён
	и приводит к краху игры. С файлом
	оригинальной японской версии эта
	проблема отсутствует.</SPAN></FONT></P>
	<LI><P ALIGN=LEFT><FONT SIZE=3><SPAN STYLE="font-weight: normal">При
	создании </SPAN><SPAN STYLE="font-weight: normal">ecl-файла
	может возникнуть ошибка, из-за которой
	собираемый файл будет повреждён, а
	дат-файл с ним будет приводить к краху
	игры.</SPAN><SPAN STYLE="font-weight: normal"> Причина
	бага в том, что </SPAN><SPAN STYLE="font-weight: normal">thecl
	некорректно о</SPAN><SPAN STYLE="font-weight: normal">брабатывает
	экранированные двойные кавычки (символы
	</SPAN><B>\&quot;</B><SPAN STYLE="font-weight: normal">),
	используемые в названиях спеллкарт.
	Проблему решает замена всех вхождений
	данной комбинации </SPAN><SPAN STYLE="font-weight: normal">на
	любую другую, например, одиночную
	кавычку. </SPAN></FONT>
	</P>
</UL>
<UL>
	<P ALIGN=LEFT></P>
</UL>
</BODY>
</HTML>